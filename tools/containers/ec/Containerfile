# SPDX-License-Identifier: CC0-1.0
# SPDX-FileCopyrightText: NONE

# A container for System76 EC development.

ARG CONTAINER_IMAGE="localhost/system76/sdcc:4.4.0"

FROM ${CONTAINER_IMAGE}
ARG RUST_TOOLCHAIN

RUN apt-get --quiet update \
    && apt-get --quiet install --no-install-recommends --assume-yes \
        bash \
        binutils \
        ca-certificates \
        gcc \
        git \
        libc6-dev \
        libhidapi-dev \
        make \
        pkgconf \
        reuse \
        rustup \
        shellcheck \
        uncrustify \
        xxd \
    && apt-get clean

# XXX: rustup 1.27 does not recognize toolchain if preceding option specifies
# a comma separated list as an argument with a space.
# Ref: https://github.com/rust-lang/rustup/issues/4073
RUN rustup toolchain install \
        --target x86_64-unknown-linux-gnu,x86_64-unknown-uefi \
        --profile minimal \
        --component=clippy,rustfmt \
        ${RUST_TOOLCHAIN}

WORKDIR /workspace
CMD ["bash"]
